<!DOCTYPE html>
<html>
  <head>
    <title>PA3</title>
    <script src="http://graphics.cs.wisc.edu/JS/twgl-full.min.js"></script>
  </head>
  <body>
    <div style="float:left"><canvas id="canvas" height="700" width="1000">
    </canvas></div>

    <div>
      <div><h3>Rotate By X Axis</h3><input id="slider1" type="range" min="0" max="100" />
      <div><h3>Vision Level</h3><input id="slider3" class="vertical-range" type="range" min="-100" max="100" />
      <div><h3>Density of the skeleton</h3><input id="slider4" type="range" min="10" max="30" /></div>
      <div><button id="button" onclick="toggle();">Toggle Orthographic / Perspective</button></div>
      <div><h3>Turn off motion 1</h3><input id="bool1" type="checkbox"/>
      <div><h3>Turn off motion 2</h3><input id="bool2" type="checkbox"/>
      <div><h3>Change the motion speed</h3><input id="slider2" type="range" min="0.5" max="4" step="0.05" />
      <div><h3>Hide Axis</h3><input id="bool3" type="checkbox"/>
    </div>
  </body>
</html>
<style>
  /*Got the following style code from https://codepen.io/ATC-test/pen/myPNqW*/
  .vertical-range {
    -webkit-appearance: slider-vertical;
  }
</style>
<script type="text/javascript">
  var canvas=document.getElementById('canvas');
  var context=canvas.getContext('2d');
  var m4=twgl.m4;

  var slider1 = document.getElementById('slider1');
  slider1.value = 0;
  var slider2 = document.getElementById('slider2');
  slider2.value = 1;
  var slider3 = document.getElementById('slider3');
  slider3.value = 100;
  var slider4 = document.getElementById('slider4');
  slider4.value = 15;
  var bool1 = document.getElementById('bool1');
  var bool2 = document.getElementById('bool2');
  var bool3 = document.getElementById('bool3');

  var persp = true;
  function moveToTx(x,y,z,Tx){
    var location = [x,y,z];
    var locationTx = m4.transformPoint(Tx,location);
    context.moveTo(locationTx[0],-locationTx[1]);
  }
  function lineToTx(x,y,z,Tx){
    var location = [x,y,z];
    var locationTx = m4.transformPoint(Tx,location);
    context.lineTo(locationTx[0],-locationTx[1]);
  }

  function drawSkeleton1(r1,r2,ag,Tx){
    moveToTx(r1-Math.cos(ag)*r2,0,r2*Math.sin(ag),Tx);
    for(j=Math.PI/32;j<2.001*Math.PI;j+=Math.PI/32){
      lineToTx((r1-Math.cos(ag)*r2)*Math.cos(j),
               (r1-Math.cos(ag)*r2)*Math.sin(j),
               r2*Math.sin(ag),Tx);
    }
    context.stroke();
  }
  function drawSkeleton2(r1,r2,Tx){
    moveToTx((r1-r2),0,0,Tx);
    for(j=Math.PI/32;j<2.001*Math.PI;j+=Math.PI/32){
      lineToTx(r1-r2*Math.cos(j),0,
               r2*Math.sin(j),Tx);
    }
    context.stroke();
  }
  function drawShape(r1,r2,ag,Tx,n,turnVert,turnHori){
    ag =- ag;
    var angleD = Math.PI*2/n;
    for(i = 0 ; i <= n ; i ++){
      var ag1, ag2;
      if(turnVert){
        ag1 = ag;
      }
      else {
        ag1 = 0;
      }
      if(turnHori){
        ag2 = ag;
      }
      else{
        ag2 = 0;
      }
      drawSkeleton1(r1,r2,(ag1+i*angleD),Tx);
      var TempTx = m4.multiply(m4.axisRotation(axis3,ag2+i*angleD),Tx);
      drawSkeleton2(r1,r2,TempTx);
    }
  }
  function drawAxes(Tx){
    moveToTx(0,0,0,Tx);
    lineToTx(1000,0,0,Tx);
    context.stroke();
    moveToTx(0,0,0,Tx);
    lineToTx(0,1000,0,Tx);
    context.stroke();
    moveToTx(0,0,0,Tx);
    lineToTx(0,0,1000,Tx);
    context.stroke();
  }

  var axis1 = [1,0,0];
  var axis2 = [0,1,0];
  var axis3 = [0,0,1];
  var ag = 0;
  function drawSingleElement() {
    var n = document.getElementById("slider4").value;
    var angle1 = slider1.value*0.02*Math.PI;
    var level = (slider3.value-100)*0.005*Math.PI;
    var turnVert = !bool1.checked;
    var turnHori = !bool2.checked;
    var HideAxis = bool3.checked;

    var stack = [m4.identity()];

    var eye = [800,800,800*Math.cos(level)];
    var target = [0,0,0];
    var up = [0,0,1];

    var Tmodel = m4.axisRotation(axis1,angle1);
    var Tcamera = m4.inverse(m4.lookAt(eye,target,up));
    var Tprojection;
    if(persp){
      Tprojection=m4.perspective(Math.PI/8,1,3,400);
    }
    else {
      Tprojection=m4.ortho(-250,250,-200,300,-2,2);
    }
    var Tviewport = m4.multiply(m4.scaling([200,200,200]),m4.translation([500,-350,0]));
    var Tcpv = m4.multiply(m4.multiply(Tcamera,Tprojection),Tviewport);
    var Tmcpv = m4.multiply(Tmodel,Tcpv);
    if(!HideAxis){
      drawAxes(Tcpv);
    }
    drawShape(200,100,ag,Tmcpv,n,turnVert,turnHori);
    update();
    window.requestAnimationFrame(draw);
  }
  function update(){
    speed = slider2.value;
    ag = (ag + Math.PI/320*speed) % (Math.PI*2);
  }
  function toggle(){
    persp = !persp;
  }
  window.onload = draw;
</script>
